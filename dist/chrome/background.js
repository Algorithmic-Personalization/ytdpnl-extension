(()=>{"use strict";var e=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},t=function(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))},r=function(){return"1"===localStorage.getItem("debug")},n=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r()&&("error"!==n[0]?console.log.apply(console,t([],e(n),!1)):console.error.apply(console,t([],e(n.slice(1)),!1)))},o=(function(){if(navigator.userAgent.includes("Chrome"));}(),function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function c(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}l((n=n.apply(e,t||[])).next())}))}),a=function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(l){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},i=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};chrome.tabs.onActivated.addListener((function(e){var t,r;console.log("New tab:",e);var n=e.tabId;if(void 0!==n){chrome.tabs.sendMessage(n,{type:"your-tab-is-active",tabId:e.tabId},(function(e){console.log("Tab ".concat(n," replied:"),e)}));var o=function(t){t!==n&&chrome.tabs.sendMessage(t,{type:"your-tab-is-not-active",tabId:e.tabId},(function(e){console.log("Tab ".concat(t," replied:"),e)}))};try{for(var a=c(l),i=a.next();!i.done;i=a.next())o(i.value)}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}}));var l=new Set;chrome.tabs.onRemoved.addListener((function(e){console.log("Tab removed:",e),l.delete(e)})),o(void 0,void 0,void 0,(function(){var e,t,r,u,f,s,d,y,b;return a(this,(function(v){switch(v.label){case 0:return[4,Promise.all([o(void 0,void 0,void 0,(function(){return a(this,(function(e){return[2,new Promise((function(e,t){chrome.tabs.query({},(function(r){chrome.runtime.lastError?t(chrome.runtime.lastError):e(r)}))}))]}))})),o(void 0,void 0,void 0,(function(){return a(this,(function(e){return[2,new Promise((function(e,t){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(r){var n=i(r,1)[0];chrome.runtime.lastError?t(chrome.runtime.lastError):e(n)}))}))]}))}))])];case 1:e=i.apply(void 0,[v.sent(),2]),t=e[0],r=e[1],console.log("Initial tabs:",t),u=function(e){if(void 0===e)return"continue";l.add(e),e===(null==r?void 0:r.id)?(n("active tab:",r),chrome.tabs.sendMessage(e,{type:"your-tab-is-active",tabId:e},(function(t){console.log("tab ".concat(e," replied:"),t)}))):chrome.tabs.sendMessage(e,{type:"your-tab-is-not-active",tabId:e},(function(t){console.log("tab ".concat(e," replied:"),t)}))};try{for(f=c(t),s=f.next();!s.done;s=f.next())d=s.value.id,u(d)}catch(e){y={error:e}}finally{try{s&&!s.done&&(b=f.return)&&b.call(f)}finally{if(y)throw y.error}}return[2]}}))})).catch((function(e){n("error","failed to start background script:",e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2dyb3VuZC5qcyIsIm1hcHBpbmdzIjoibWZBa0JhQSxFQUFVLFdBQU0sTUFBMkMsTUFBbENDLGFBQWFDLFFBQVEsUUFBOUIsRUFFaEJDLEVBQU0sVyxJQUFDLHNEQUNkSCxNQUlXLFVBQVpJLEVBQUssR0FLVEMsUUFBUUYsSUFBRyxNQUFYRSxRQUFPLE9BQVFELElBQUksSUFKbEJDLFFBQVFDLE1BQUssTUFBYkQsUUFBTyxPQUFVRCxFQUFLRyxNQUFNLEtBQUUsSUFLaEMsRSxHQThPMEIsV0FDekIsR0FINkJDLFVBQVVDLFVBQVVDLFNBQVMsV0FnRDNELENBRTJCQyxHLHU2RENuUzNCQyxPQUFPQyxLQUFLQyxZQUFZQyxhQUFZLFNBQUFDLEcsUUFDbkNYLFFBQVFGLElBQUksV0FBWWEsR0FDakIsSUFBQUMsRUFBU0QsRUFBRyxNQUVuQixRQUFjRSxJQUFWRCxFQUFKLENBSUFMLE9BQU9DLEtBQUtNLFlBQVlGLEVBQU8sQ0FDOUJHLEtBQU0scUJBQ05ILE1BQU9ELEVBQUlDLFFBQ1QsU0FBQUksR0FDRmhCLFFBQVFGLElBQUksY0FBT2MsRUFBSyxhQUFhSSxFQUN0QyxJLGVBRVdDLEdBQ05BLElBQU9MLEdBQ1ZMLE9BQU9DLEtBQUtNLFlBQVlHLEVBQUksQ0FDM0JGLEtBQU0seUJBQ05ILE1BQU9ELEVBQUlDLFFBQ1QsU0FBQUksR0FDRmhCLFFBQVFGLElBQUksY0FBT21CLEVBQUUsYUFBYUQsRUFDbkMsRyxNQVBGLElBQWlCLFFBQUFFLEdBQU0sOEIsRUFBVixRLG1HQVVkLElBRUEsSUFBTUEsRUFBUyxJQUFJQyxJQUVuQlosT0FBT0MsS0FBS1ksVUFBVVYsYUFBWSxTQUFBRSxHQUNqQ1osUUFBUUYsSUFBSSxlQUFnQmMsR0FDNUJNLEVBQWEsT0FBQ04sRUFDZixJQUVhLG1DLHdFQUNxQixTQUFNUyxRQUFRQyxJQUFJLENBM0RqQyxtQywyQkFBd0MsYUFBSUQsU0FBUSxTQUFDRSxFQUFTQyxHQUNoRmpCLE9BQU9DLEtBQUtpQixNQUFNLENBQUMsR0FBRyxTQUFBakIsR0FDakJELE9BQU9tQixRQUFRQyxVQUNsQkgsRUFBT2pCLE9BQU9tQixRQUFRQyxXQUl2QkosRUFBUWYsRUFDVCxHQUNELEksT0FFcUIsbUMsMkJBQ3BCLGFBQUlhLFNBQVEsU0FBQ0UsRUFBU0MsR0FFckJqQixPQUFPQyxLQUFLaUIsTUFEUyxDQUFDRyxRQUFRLEVBQU1DLG1CQUFtQixJQUN2QixTQUFDLEcsSUFBQ2xCLEVBQUQsT0FBSSxHQUNoQ0osT0FBT21CLFFBQVFDLFVBQ2xCSCxFQUFPakIsT0FBT21CLFFBQVFDLFdBSXZCSixFQUFRWixFQUNULEdBQ0QsSSxpQkFxQ00sa0JBQTJCLFNBRy9CLElBSEttQixFQUFXLEtBQUVDLEVBQVMsS0FLN0IvQixRQUFRRixJQUFJLGdCQUFpQmdDLEcsV0FDakJiLEdBQ1gsUUFBV0osSUFBUEksRSxpQkFJSkMsRUFBT2MsSUFBSWYsR0FFUEEsS0FBT2MsYUFBUyxFQUFUQSxFQUFXZCxLQUNyQm5CLEVBQUksY0FBZWlDLEdBRW5CeEIsT0FBT0MsS0FBS00sWUFBWUcsRUFBSSxDQUMzQkYsS0FBTSxxQkFDTkgsTUFBT0ssSUFDTCxTQUFBRCxHQUNGaEIsUUFBUUYsSUFBSSxjQUFPbUIsRUFBRSxhQUFhRCxFQUNuQyxLQUVBVCxPQUFPQyxLQUFLTSxZQUFZRyxFQUFJLENBQzNCRixLQUFNLHlCQUNOSCxNQUFPSyxJQUNMLFNBQUFELEdBQ0ZoQixRQUFRRixJQUFJLGNBQU9tQixFQUFFLGFBQWFELEVBQ25DLEcsTUF0QkYsSUFBbUIsSUFBQWMsR0FBVyw4QkFBbEJiLEVBQUUsVyxFQUFGQSxFLG1IQTJCRCxPQUFDLFNBQUFnQixHQUNabkMsRUFBSSxRQUFTLHFDQUFzQ21DLEVBQ3BELEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95dGRwbmwvLi9zcmMvbGliLnRzIiwid2VicGFjazovL3l0ZHBubC8uL3NyYy9iYWNrZ3JvdW5kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIFJlY29tbWVuZGF0aW9uIGZyb20gJy4vY29tbW9uL3R5cGVzL1JlY29tbWVuZGF0aW9uJztcbmltcG9ydCB7dHlwZSBSZWNvbW1lbmRhdGlvbkJhc2V9IGZyb20gJy4vY29tbW9uL3R5cGVzL1JlY29tbWVuZGF0aW9uJztcbmltcG9ydCB7Z2V0fSBmcm9tICcuL2NvbW1vbi91dGlsJztcblxuZXhwb3J0IGNvbnN0IGlzT25WaWRlb1BhZ2UgPSAoKSA9PiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICcvd2F0Y2gnO1xuZXhwb3J0IGNvbnN0IGlzVmlkZW9QYWdlID0gKHVybD86IHN0cmluZyk6IHVybCBpcyBzdHJpbmcgPT4gQm9vbGVhbihcblx0dXJsICYmIG5ldyBVUkwodXJsKS5wYXRobmFtZS5zdGFydHNXaXRoKCcvd2F0Y2gnKSxcbik7XG5leHBvcnQgY29uc3QgaXNPbkhvbWVQYWdlID0gKCkgPT4gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAnLyc7XG5leHBvcnQgY29uc3QgaXNIb21lUGFnZSA9ICh1cmw6IHN0cmluZykgPT4ge1xuXHR0cnkge1xuXHRcdHJldHVybiBuZXcgVVJMKHVybCkucGF0aG5hbWUgPT09ICcvJztcblx0fSBjYXRjaCB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59O1xuXG5leHBvcnQgY29uc3QgZGVidWcgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcbmV4cG9ydCBjb25zdCBpc0RlYnVnID0gKCkgPT4gZGVidWcgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RlYnVnJykgPT09ICcxJztcblxuZXhwb3J0IGNvbnN0IGxvZyA9ICguLi5hcmdzOiBhbnlbXSkgPT4ge1xuXHRpZiAoIWlzRGVidWcoKSkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmIChhcmdzWzBdID09PSAnZXJyb3InKSB7XG5cdFx0Y29uc29sZS5lcnJvciguLi5hcmdzLnNsaWNlKDEpKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRjb25zb2xlLmxvZyguLi5hcmdzKTtcbn07XG5cbmV4cG9ydCBjb25zdCBleHRyYWN0WXRJbml0aWFsRGF0YSA9IChyYXdQYWdlSHRtbDogc3RyaW5nKSA9PiB7XG5cdGNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcblx0Y29uc3QgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhyYXdQYWdlSHRtbCwgJ3RleHQvaHRtbCcpO1xuXHRjb25zdCBzY3JpcHRzID0gQXJyYXkuZnJvbShkb2MucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0JykpO1xuXG5cdHJldHVybiBzY3JpcHRzLmZpbmQoc2NyaXB0ID0+IHtcblx0XHRjb25zdCB7dGV4dENvbnRlbnR9ID0gc2NyaXB0O1xuXG5cdFx0aWYgKHRleHRDb250ZW50KSB7XG5cdFx0XHRyZXR1cm4gdGV4dENvbnRlbnQudHJpbVN0YXJ0KCkuc3RhcnRzV2l0aCgndmFyIHl0SW5pdGlhbERhdGEgPSAnKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0pO1xufTtcblxuZXhwb3J0IHR5cGUgVHJlZUNhbGxiYWNrID0gKG5vZGU6IHVua25vd24sIHBhdGg6IHN0cmluZ1tdLCBmdWxsT2JqZWN0PzogdW5rbm93bikgPT4gJ3JlY3Vyc2UnIHwgJ3N0b3AnO1xuXG5leHBvcnQgY29uc3Qgd2Fsa1RyZWUgPSAoY2I6IFRyZWVDYWxsYmFjaykgPT4gKG5vZGU6IHVua25vd24pID0+IHtcblx0Y29uc3Qgd2FsayA9IChub2RlOiB1bmtub3duLCBwYXRoOiBzdHJpbmdbXSwgZnVsbE9iamVjdDogdW5rbm93bikgPT4ge1xuXHRcdGNvbnN0IGFuZFRoZW4gPSBjYihub2RlLCBwYXRoLCBmdWxsT2JqZWN0KTtcblxuXHRcdGlmIChhbmRUaGVuID09PSAnc3RvcCcpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAobm9kZSA9PT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG5vZGUpKSB7XG5cdFx0XHRmb3IgKGNvbnN0IFtpbmRleCwgdmFsdWVdIG9mIG5vZGUuZW50cmllcygpKSB7XG5cdFx0XHRcdHdhbGsodmFsdWUsIFsuLi5wYXRoLCBpbmRleC50b1N0cmluZygpXSwgZnVsbE9iamVjdCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIG5vZGUgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhub2RlKSkge1xuXHRcdFx0XHR3YWxrKHZhbHVlLCBbLi4ucGF0aCwga2V5XSwgZnVsbE9iamVjdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdHdhbGsobm9kZSwgW10sIG5vZGUpO1xufTtcblxuZXhwb3J0IHR5cGUgQ2hhbm5lbFJlY29tbWVuZGF0aW9uID0ge1xuXHR0aXRsZTogc3RyaW5nO1xuXHRwYXRoOiBzdHJpbmdbXTtcblx0cmVjb21tZW5kYXRpb246IFJlY29tbWVuZGF0aW9uO1xuXHRyYXdOb2RlOiB1bmtub3duO1xufTtcblxuY29uc3QgZ2V0TWluaWF0dXJlVXJsID0gKG5vZGU6IHVua25vd24pID0+IHtcblx0aWYgKHR5cGVvZiBub2RlICE9PSAnb2JqZWN0JyB8fCBub2RlID09PSBudWxsKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIG5vZGUnKTtcblx0fVxuXG5cdGNvbnN0IHZpZGVvSWQgPSBnZXQoWyd2aWRlb0lkJ10pKG5vZGUpIGFzIHN0cmluZztcblxuXHRjb25zdCBkZWZhdWx0VXJsID0gYGh0dHBzOi8vaS55dGltZy5jb20vdmkvJHt2aWRlb0lkfS9ocWRlZmF1bHQuanBnYDtcblxuXHRjb25zdCB0aHVtYm5haWxzID0gZ2V0KFsndGh1bWJuYWlsJywgJ3RodW1ibmFpbHMnXSkobm9kZSkgYXMgQXJyYXk8e3VybDogc3RyaW5nOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlcn0+O1xuXG5cdGlmICghdGh1bWJuYWlscykge1xuXHRcdHJldHVybiBkZWZhdWx0VXJsO1xuXHR9XG5cblx0Y29uc3Qgc29ydGVkVGh1bWJuYWlscyA9IHRodW1ibmFpbHMuc29ydCgoYSwgYikgPT4gKGIud2lkdGggKiBiLmhlaWdodCkgLSAoYS53aWR0aCAqIGEuaGVpZ2h0KSk7XG5cblx0cmV0dXJuIHNvcnRlZFRodW1ibmFpbHNbMF0udXJsO1xufTtcblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RSZWNvbW1lbmRhdGlvbnMgPSAoXG5cdGluaXRpYWxEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbik6IENoYW5uZWxSZWNvbW1lbmRhdGlvbltdID0+IHtcblx0Y29uc3QgcmVjb21tZW5kYXRpb25zOiBDaGFubmVsUmVjb21tZW5kYXRpb25bXSA9IFtdO1xuXG5cdGNvbnN0IGNiOiBUcmVlQ2FsbGJhY2sgPSAobm9kZSwgcGF0aCwgZnVsbE9iamVjdCkgPT4ge1xuXHRcdGlmIChwYXRoLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0cmV0dXJuICdyZWN1cnNlJztcblx0XHR9XG5cblx0XHRjb25zdCBnZXRUaXRsZSA9ICgpID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiBnZXQoWyd0aXRsZScsICdydW5zJywgJzAnLCAndGV4dCddKShub2RlKSBhcyBzdHJpbmc7XG5cdFx0XHR9IGNhdGNoIHtcblx0XHRcdFx0cmV0dXJuIGdldChbJ3RpdGxlJywgJ3NpbXBsZVRleHQnXSkobm9kZSkgYXMgc3RyaW5nO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRjb25zdCBsYXN0S2V5ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xuXG5cdFx0aWYgKGxhc3RLZXkgPT09ICd2aWRlb1JlbmRlcmVyJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Y29uc3QgdGl0bGUgPSBnZXRUaXRsZSgpO1xuXG5cdFx0XHRcdGNvbnN0IHZpZGVvSWQgPSBnZXQoWyd2aWRlb0lkJ10pKG5vZGUpIGFzIHN0cmluZztcblxuXHRcdFx0XHRjb25zdCBjaGFubmVsTWluaWF0dXJlVXJsID0gZ2V0KFtcblx0XHRcdFx0XHQnY2hhbm5lbFRodW1ibmFpbFN1cHBvcnRlZFJlbmRlcmVycycsXG5cdFx0XHRcdFx0J2NoYW5uZWxUaHVtYm5haWxXaXRoTGlua1JlbmRlcmVyJyxcblx0XHRcdFx0XHQndGh1bWJuYWlsJyxcblx0XHRcdFx0XHQndGh1bWJuYWlscycsXG5cdFx0XHRcdFx0JzAnLFxuXHRcdFx0XHRcdCd1cmwnLFxuXHRcdFx0XHRdKShub2RlKSBhcyBzdHJpbmc7XG5cblx0XHRcdFx0Y29uc3QgY2hhbm5lbFNob3J0TmFtZSA9IGdldChbXG5cdFx0XHRcdFx0J293bmVyVGV4dCcsXG5cdFx0XHRcdFx0J3J1bnMnLFxuXHRcdFx0XHRcdCcwJyxcblx0XHRcdFx0XHQnbmF2aWdhdGlvbkVuZHBvaW50Jyxcblx0XHRcdFx0XHQnYnJvd3NlRW5kcG9pbnQnLFxuXHRcdFx0XHRcdCdjYW5vbmljYWxCYXNlVXJsJyxcblx0XHRcdFx0XSkobm9kZSkgYXMgc3RyaW5nO1xuXG5cdFx0XHRcdGNvbnN0IGdldEhvdmVyQW5pbWF0aW9uVXJsID0gKCkgPT4ge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZ2V0KFtcblx0XHRcdFx0XHRcdFx0J3JpY2hUaHVtYm5haWwnLFxuXHRcdFx0XHRcdFx0XHQnbW92aW5nVGh1bWJuYWlsUmVuZGVyZXInLFxuXHRcdFx0XHRcdFx0XHQnbW92aW5nVGh1bWJuYWlsRGV0YWlscycsXG5cdFx0XHRcdFx0XHRcdCd0aHVtYm5haWxzJyxcblx0XHRcdFx0XHRcdFx0JzAnLFxuXHRcdFx0XHRcdFx0XHQndXJsJyxcblx0XHRcdFx0XHRcdF0pKG5vZGUpIGFzIHN0cmluZztcblx0XHRcdFx0XHR9IGNhdGNoIHtcblx0XHRcdFx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IG1pbmlhdHVyZVVybCA9IGdldE1pbmlhdHVyZVVybChub2RlKTtcblxuXHRcdFx0XHRjb25zdCByZWNvbW1lbmRhdGlvbjogUmVjb21tZW5kYXRpb24gPSB7XG5cdFx0XHRcdFx0dmlkZW9JZCxcblx0XHRcdFx0XHR0aXRsZSxcblx0XHRcdFx0XHR1cmw6IGBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PSR7dmlkZW9JZH1gLFxuXHRcdFx0XHRcdGNoYW5uZWxOYW1lOiBnZXQoWydsb25nQnlsaW5lVGV4dCcsICdydW5zJywgJzAnLCAndGV4dCddKShub2RlKSBhcyBzdHJpbmcsXG5cdFx0XHRcdFx0dmlld3M6IGdldChbJ3Nob3J0Vmlld0NvdW50VGV4dCcsICdzaW1wbGVUZXh0J10pKG5vZGUpIGFzIHN0cmluZyxcblx0XHRcdFx0XHRwdWJsaXNoZWRTaW5jZTogZ2V0KFsncHVibGlzaGVkVGltZVRleHQnLCAnc2ltcGxlVGV4dCddKShub2RlKSBhcyBzdHJpbmcsXG5cdFx0XHRcdFx0bWluaWF0dXJlVXJsLFxuXHRcdFx0XHRcdHBlcnNvbmFsaXphdGlvbjogJ3BlcnNvbmFsaXplZCcsXG5cdFx0XHRcdFx0Y2hhbm5lbE1pbmlhdHVyZVVybCxcblx0XHRcdFx0XHRjaGFubmVsU2hvcnROYW1lLFxuXHRcdFx0XHRcdGhvdmVyQW5pbWF0aW9uVXJsOiBnZXRIb3ZlckFuaW1hdGlvblVybCgpLFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcblx0XHRcdFx0XHR0aXRsZSxcblx0XHRcdFx0XHRwYXRoLFxuXHRcdFx0XHRcdHJlY29tbWVuZGF0aW9uLFxuXHRcdFx0XHRcdHJhd05vZGU6IG5vZGUsXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiAnc3RvcCc7XG5cdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRsb2coJ2Vycm9yJywgJ3BhcnNpbmcgdmlkZW9SZW5kZXJlcicsIHtwYXRoLCBub2RlLCBlcnJvcn0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChsYXN0S2V5ID09PSAnZ3JpZFZpZGVvUmVuZGVyZXInKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRjb25zdCB2aWRlb0lkID0gZ2V0KFsndmlkZW9JZCddKShub2RlKSBhcyBzdHJpbmc7XG5cblx0XHRcdFx0Y29uc3QgdGl0bGUgPSBnZXRUaXRsZSgpO1xuXG5cdFx0XHRcdGNvbnN0IGNoYW5uZWxOYW1lID0gZ2V0KFtcblx0XHRcdFx0XHQnbWV0YWRhdGEnLFxuXHRcdFx0XHRcdCdjaGFubmVsTWV0YWRhdGFSZW5kZXJlcicsXG5cdFx0XHRcdFx0J3RpdGxlJyxcblx0XHRcdFx0XSkoZnVsbE9iamVjdCkgYXMgc3RyaW5nO1xuXG5cdFx0XHRcdGNvbnN0IGNoYW5uZWxWYW5pdHlVcmwgPSBnZXQoW1xuXHRcdFx0XHRcdCdtZXRhZGF0YScsXG5cdFx0XHRcdFx0J2NoYW5uZWxNZXRhZGF0YVJlbmRlcmVyJyxcblx0XHRcdFx0XHQndmFuaXR5Q2hhbm5lbFVybCcsXG5cdFx0XHRcdF0pKGZ1bGxPYmplY3QpIGFzIHN0cmluZztcblxuXHRcdFx0XHRjb25zdCBwYXJ0c09mQ2hhbmVsVXJsID0gY2hhbm5lbFZhbml0eVVybC5zcGxpdCgnLycpO1xuXG5cdFx0XHRcdGNvbnN0IGNoYW5uZWxTaG9ydE5hbWUgPSBwYXJ0c09mQ2hhbmVsVXJsW3BhcnRzT2ZDaGFuZWxVcmwubGVuZ3RoIC0gMV07XG5cblx0XHRcdFx0Y29uc3QgcmVjb21tZW5kYXRpb246IFJlY29tbWVuZGF0aW9uID0ge1xuXHRcdFx0XHRcdHRpdGxlLFxuXHRcdFx0XHRcdHVybDogYGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JHt2aWRlb0lkfWAsXG5cdFx0XHRcdFx0dmlkZW9JZCxcblx0XHRcdFx0XHRtaW5pYXR1cmVVcmw6IGdldE1pbmlhdHVyZVVybChub2RlKSxcblx0XHRcdFx0XHRjaGFubmVsTmFtZSxcblx0XHRcdFx0XHR2aWV3czogZ2V0KFsndmlld0NvdW50VGV4dCcsICdzaW1wbGVUZXh0J10pKG5vZGUpIGFzIHN0cmluZyxcblx0XHRcdFx0XHRwdWJsaXNoZWRTaW5jZTogZ2V0KFsncHVibGlzaGVkVGltZVRleHQnLCAnc2ltcGxlVGV4dCddKShub2RlKSBhcyBzdHJpbmcsXG5cdFx0XHRcdFx0cGVyc29uYWxpemF0aW9uOiAncGVyc29uYWxpemVkJyxcblx0XHRcdFx0XHRob3ZlckFuaW1hdGlvblVybDogZ2V0KFtcblx0XHRcdFx0XHRcdCdyaWNoVGh1bWJuYWlsJyxcblx0XHRcdFx0XHRcdCdtb3ZpbmdUaHVtYm5haWxSZW5kZXJlcicsXG5cdFx0XHRcdFx0XHQnbW92aW5nVGh1bWJuYWlsRGV0YWlscycsXG5cdFx0XHRcdFx0XHQndGh1bWJuYWlscycsXG5cdFx0XHRcdFx0XHQnMCcsXG5cdFx0XHRcdFx0XHQndXJsJyxcblx0XHRcdFx0XHRdKShub2RlKSBhcyBzdHJpbmcsXG5cdFx0XHRcdFx0Y2hhbm5lbE1pbmlhdHVyZVVybDogZ2V0KFtcblx0XHRcdFx0XHRcdCdtZXRhZGF0YScsXG5cdFx0XHRcdFx0XHQnY2hhbm5lbE1ldGFkYXRhUmVuZGVyZXInLFxuXHRcdFx0XHRcdFx0J2F2YXRhcicsXG5cdFx0XHRcdFx0XHQndGh1bWJuYWlscycsXG5cdFx0XHRcdFx0XHQnMCcsXG5cdFx0XHRcdFx0XHQndXJsJyxcblx0XHRcdFx0XHRdKShmdWxsT2JqZWN0KSBhcyBzdHJpbmcsXG5cdFx0XHRcdFx0Y2hhbm5lbFNob3J0TmFtZSxcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRyZWNvbW1lbmRhdGlvbnMucHVzaCh7XG5cdFx0XHRcdFx0dGl0bGU6IHJlY29tbWVuZGF0aW9uLnRpdGxlLFxuXHRcdFx0XHRcdHBhdGgsXG5cdFx0XHRcdFx0cmVjb21tZW5kYXRpb24sXG5cdFx0XHRcdFx0cmF3Tm9kZTogbm9kZSxcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRsb2coJ2Vycm9yJywgJ3BhcnNpbmcgZ3JpZFZpZGVvUmVuZGVyZXInLCB7cGF0aCwgbm9kZSwgZXJyb3J9KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICdzdG9wJztcblx0XHR9XG5cblx0XHRyZXR1cm4gJ3JlY3Vyc2UnO1xuXHR9O1xuXG5cdHdhbGtUcmVlKGNiKShpbml0aWFsRGF0YSk7XG5cblx0cmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbn07XG5cbmV4cG9ydCBjb25zdCBpc0Nocm9tZSA9ICgpID0+IG5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoJ0Nocm9tZScpO1xuXG5jb25zdCBjcmVhdGVJbWFnZUV4aXN0cyA9ICgpOiAoKHVybDogc3RyaW5nKSA9PiBQcm9taXNlPGJvb2xlYW4+KSA9PiB7XG5cdGlmIChpc0Nocm9tZSgpKSB7XG5cdFx0cmV0dXJuIGFzeW5jIHVybCA9PiB7XG5cdFx0XHRjb25zdCByID0gYXdhaXQgZmV0Y2godXJsLCB7bWV0aG9kOiAnSEVBRCd9KTtcblx0XHRcdHJldHVybiByLm9rO1xuXHRcdH07XG5cdH1cblxuXHRjb25zdCB0aW1lb3V0ID0gNTAwMDtcblx0bGV0IGFzc3VtZUxvYWRlZCA9IGZhbHNlO1xuXG5cdHJldHVybiBhc3luYyB1cmwgPT4ge1xuXHRcdGlmIChhc3N1bWVMb2FkZWQpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRhc3N1bWVMb2FkZWQgPSB0cnVlO1xuXHRcdFx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaW1nKTtcblx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKCdUaW1lb3V0JykpO1xuXHRcdFx0XHR9LCB0aW1lb3V0KTtcblxuXHRcdFx0XHRjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcblx0XHRcdFx0aW1nLm9ubG9hZCA9ICgpID0+IHtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGltZyk7XG5cdFx0XHRcdFx0cmVzb2x2ZSh0cnVlKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRpbWcub25lcnJvciA9ICgpID0+IHtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGltZyk7XG5cdFx0XHRcdFx0cmVzb2x2ZShmYWxzZSk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0aW1nLnN0eWxlLndpZHRoID0gJzFweCc7XG5cdFx0XHRcdGltZy5zdHlsZS5oZWlnaHQgPSAnMXB4JztcblxuXHRcdFx0XHRpbWcuc3JjID0gdXJsO1xuXG5cdFx0XHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1nKTtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG59O1xuXG5leHBvcnQgY29uc3QgaW1hZ2VFeGlzdHMgPSBjcmVhdGVJbWFnZUV4aXN0cygpO1xuXG5leHBvcnQgY29uc3QgaXNMb2dnZWRJbiA9ICgpID0+IEJvb2xlYW4oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2F2YXRhci1idG4nKSk7XG5cbmV4cG9ydCBjb25zdCBpc05vdExvZ2dlZEluID0gKCkgPT4gQm9vbGVhbihcblx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYVtocmVmXj1cImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9TZXJ2aWNlTG9naW4/c2VydmljZT15b3V0dWJlXCJdJyksXG4pO1xuXG5leHBvcnQgdHlwZSBSZXMgPSAneWVzJyB8ICdubycgfCAnbWF5YmUnO1xuXG5leHBvcnQgY29uc3QgaXNMb2dnZWRJbkZvclN1cmVZdCA9IGFzeW5jICgpOiBQcm9taXNlPFJlcz4gPT4ge1xuXHRjb25zdCBjaGVjayA9ICgpOiBSZXMgPT4ge1xuXHRcdGlmIChpc0xvZ2dlZEluKCkpIHtcblx0XHRcdHJldHVybiAneWVzJztcblx0XHR9XG5cblx0XHRpZiAoaXNOb3RMb2dnZWRJbigpKSB7XG5cdFx0XHRyZXR1cm4gJ25vJztcblx0XHR9XG5cblx0XHRyZXR1cm4gJ21heWJlJztcblx0fTtcblxuXHRyZXR1cm4gbmV3IFByb21pc2U8UmVzPihyZXNvbHZlID0+IHtcblx0XHRjb25zdCByZXMgPSBjaGVjaygpO1xuXG5cdFx0aWYgKHJlcyAhPT0gJ21heWJlJykge1xuXHRcdFx0cmVzb2x2ZShyZXMpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xuXHRcdFx0Y29uc3QgcmVzID0gY2hlY2soKTtcblxuXHRcdFx0aWYgKHJlcyAhPT0gJ21heWJlJykge1xuXHRcdFx0XHRvYnNlcnZlci5kaXNjb25uZWN0KCk7XG5cdFx0XHRcdHJlc29sdmUocmVzKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7Y2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlfSk7XG5cdH0pO1xufTtcblxuY29uc3QgbmFtZXNwYWNlID0gJ3l0ZHBubC1leHRlbnNpb24tJztcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHlwZXNcbmV4cG9ydCBjb25zdCBnZXRGcm9tTG9jYWxTdG9yYWdlID0gKGtleTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCA9PiB7XG5cdGNvbnN0IG5ld0Zvcm1hdCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKG5hbWVzcGFjZSArIGtleSk7XG5cblx0aWYgKG5ld0Zvcm1hdCkge1xuXHRcdHJldHVybiBuZXdGb3JtYXQ7XG5cdH1cblxuXHRjb25zdCBvbGRGb3JtYXQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuXG5cdGlmIChvbGRGb3JtYXQpIHtcblx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lc3BhY2UgKyBrZXksIG9sZEZvcm1hdCk7XG5cdFx0bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcblxuXHRcdHJldHVybiBvbGRGb3JtYXQ7XG5cdH1cblxuXHRyZXR1cm4gbnVsbDtcbn07XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG5leHBvcnQgY29uc3QgZ2V0RnJvbVNlc3Npb25TdG9yYWdlID0gKGtleTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCA9PiB7XG5cdGNvbnN0IG5ld0Zvcm1hdCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0obmFtZXNwYWNlICsga2V5KTtcblxuXHRpZiAobmV3Rm9ybWF0KSB7XG5cdFx0cmV0dXJuIG5ld0Zvcm1hdDtcblx0fVxuXG5cdGNvbnN0IG9sZEZvcm1hdCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oa2V5KTtcblxuXHRpZiAob2xkRm9ybWF0KSB7XG5cdFx0c2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShuYW1lc3BhY2UgKyBrZXksIG9sZEZvcm1hdCk7XG5cdFx0c2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuXG5cdFx0cmV0dXJuIG9sZEZvcm1hdDtcblx0fVxuXG5cdHJldHVybiBudWxsO1xufTtcblxuZXhwb3J0IGNvbnN0IHNhdmVUb0xvY2FsU3RvcmFnZSA9IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4ge1xuXHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuXHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lc3BhY2UgKyBrZXksIHZhbHVlKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzYXZlVG9TZXNzaW9uU3RvcmFnZSA9IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4ge1xuXHRzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG5cdHNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZXNwYWNlICsga2V5LCB2YWx1ZSk7XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlRnJvbUxvY2FsU3RvcmFnZSA9IChrZXk6IHN0cmluZykgPT4ge1xuXHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuXHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShuYW1lc3BhY2UgKyBrZXkpO1xufTtcblxuZXhwb3J0IGNvbnN0IGRlbGV0ZUZyb21TZXNzaW9uU3RvcmFnZSA9IChrZXk6IHN0cmluZykgPT4ge1xuXHRzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG5cdHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0obmFtZXNwYWNlICsga2V5KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbGVhbkxvY2FsU3RvcmFnZSA9ICgpID0+IHtcblx0Y29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGxvY2FsU3RvcmFnZSk7XG5cblx0Zm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuXHRcdGlmIChrZXkuc3RhcnRzV2l0aChuYW1lc3BhY2UpKSB7XG5cdFx0XHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuXHRcdH1cblx0fVxufTtcblxuZXhwb3J0IGNvbnN0IGNsZWFuU2Vzc2lvblN0b3JhZ2UgPSAoKSA9PiB7XG5cdGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhzZXNzaW9uU3RvcmFnZSk7XG5cblx0Zm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuXHRcdGlmIChrZXkuc3RhcnRzV2l0aChuYW1lc3BhY2UpKSB7XG5cdFx0XHRzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG5cdFx0fVxuXHR9XG59O1xuXG5leHBvcnQgY29uc3QgY2xlYW5TdG9yYWdlID0gKCkgPT4ge1xuXHRjbGVhbkxvY2FsU3RvcmFnZSgpO1xuXHRjbGVhblNlc3Npb25TdG9yYWdlKCk7XG59O1xuXG5leHBvcnQgY29uc3QgbG9hZGVySWQgPSAneXRkcG5sLWxvYWRlci1tYXNrJztcblxuZXhwb3J0IGNvbnN0IHJlbW92ZUxvYWRlck1hc2sgPSAoKSA9PiB7XG5cdGNvbnN0IG1hc2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsb2FkZXJJZCk7XG5cblx0aWYgKG1hc2spIHtcblx0XHQvLyBBZGQgYSB0aW55IHRpbWVvdXQgdG8gcmVkdWNlIGZsaWNrZXJpbmdcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdG1hc2sucmVtb3ZlKCk7XG5cdFx0fSwgMjAwKTtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHJldHVybiBmYWxzZTtcbn07XG5cbmV4cG9ydCBjb25zdCBmaW5kUGFyZW50QnlJZCA9IChlbElkOiBzdHJpbmcpID0+IChlbHQ6IEVsZW1lbnQpOiBFbGVtZW50IHwgdW5kZWZpbmVkID0+IHtcblx0Y29uc3QgcmVjdXJzZSA9IGZpbmRQYXJlbnRCeUlkKGVsSWQpO1xuXG5cdGlmIChlbHQuaWQgPT09IGVsSWQpIHtcblx0XHRyZXR1cm4gZWx0O1xuXHR9XG5cblx0aWYgKGVsdC5wYXJlbnRFbGVtZW50KSB7XG5cdFx0cmV0dXJuIHJlY3Vyc2UoZWx0LnBhcmVudEVsZW1lbnQpO1xuXHR9XG5cblx0cmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbmV4cG9ydCBjb25zdCBzbGVlcCA9IGFzeW5jIChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcblx0c2V0VGltZW91dChyZXNvbHZlLCBtcyk7XG59KTtcblxuY29uc3QgZ2V0VmlkZW9UaXRsZSA9IChub2RlOiBIVE1MRWxlbWVudCk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG5cdGNvbnN0IG1heWJlVGl0bGUgPSBub2RlLnF1ZXJ5U2VsZWN0b3IoJyN2aWRlby10aXRsZScpO1xuXG5cdGlmIChtYXliZVRpdGxlKSB7XG5cdFx0cmV0dXJuIG1heWJlVGl0bGUudGV4dENvbnRlbnQ/LnRyaW0oKTtcblx0fVxuXG5cdGlmIChub2RlLnBhcmVudEVsZW1lbnQgJiYgbm9kZS5pZCAhPT0gJ2NvbnRlbnQnKSB7XG5cdFx0cmV0dXJuIGdldFZpZGVvVGl0bGUobm9kZS5wYXJlbnRFbGVtZW50KTtcblx0fVxuXG5cdHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCByZW1vdmVMZXR0ZXJzQWZ0ZXIgPSAoc3ViU3RyTmVlZGxlOiBzdHJpbmcpID0+IChzdHI6IHN0cmluZyk6IHN0cmluZyA9PiB7XG5cdGNvbnN0IGluZGV4ID0gc3RyLmluZGV4T2Yoc3ViU3RyTmVlZGxlKTtcblxuXHRpZiAoaW5kZXggPT09IC0xKSB7XG5cdFx0cmV0dXJuIHN0cjtcblx0fVxuXG5cdHJldHVybiBzdHIuc2xpY2UoMCwgaW5kZXgpO1xufTtcblxuY29uc3QgaXNMaW5rVG9WaWRlbyA9IChsaW5rOiBIVE1MQW5jaG9yRWxlbWVudCk6IHN0cmluZyB8IGZhbHNlID0+IHtcblx0Y29uc3QgbSA9IC9cXD92PSguKykkLy5leGVjKGxpbmsuaHJlZik7XG5cblx0aWYgKG0pIHtcblx0XHRyZXR1cm4gcmVtb3ZlTGV0dGVyc0FmdGVyKCcmJykobVsxXSk7XG5cdH1cblxuXHRyZXR1cm4gZmFsc2U7XG59O1xuXG4vLyBMaW5rIHNlbGVjdG9yIGZvciBob21lOlxuY29uc3QgZG9HZXRSZWNvbW1lbmRhdGlvbkJhc2VzID0gKGxpbmtTZWxlY3Rvcjogc3RyaW5nKTogUmVjb21tZW5kYXRpb25CYXNlW10gPT4ge1xuXHRjb25zdCBsaW5rczogSFRNTEFuY2hvckVsZW1lbnRbXSA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChsaW5rU2VsZWN0b3IpKTtcblx0Y29uc3QgbWF5YmVSZXM6IEFycmF5PFJlY29tbWVuZGF0aW9uQmFzZSB8IHVuZGVmaW5lZD4gPSBsaW5rcy5tYXAobGluayA9PiB7XG5cdFx0Y29uc3QgbWF5YmVWaWRlb0lkID0gaXNMaW5rVG9WaWRlbyhsaW5rKTtcblxuXHRcdGlmIChtYXliZVZpZGVvSWQgPT09IGZhbHNlKSB7XG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHRcdH1cblxuXHRcdGNvbnN0IHZpZGVvSWQgPSBtYXliZVZpZGVvSWQ7XG5cblx0XHRjb25zdCB0aXRsZSA9IGdldFZpZGVvVGl0bGUobGluayk7XG5cblx0XHRpZiAoIXRpdGxlKSB7XG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHR2aWRlb0lkLFxuXHRcdFx0dGl0bGUsXG5cdFx0XHR1cmw6IGxpbmsuaHJlZixcblx0XHR9O1xuXHR9KTtcblxuXHRyZXR1cm4gbWF5YmVSZXMuZmlsdGVyKEJvb2xlYW4pIGFzIFJlY29tbWVuZGF0aW9uQmFzZVtdO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFJlY29tbWVuZGF0aW9uc09uUGFnZSA9IChsb2c6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4gYXN5bmMgKGxpbmtTZWxlY3Rvcjogc3RyaW5nLCBtaW5pbXVtID0gMykgPT4ge1xuXHRsZXQgYXR0ZW1wdHMgPSAwO1xuXHRjb25zdCBkZWxheXMgPSBbMTAwMCwgMjAwMCwgMzAwMCwgNTAwMCwgODAwMCwgMTMwMDBdO1xuXHRjb25zdCBtYXhBdHRlbXB0cyA9IGRlbGF5cy5sZW5ndGg7XG5cblx0cmV0dXJuIG5ldyBQcm9taXNlPFJlY29tbWVuZGF0aW9uQmFzZVtdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0Y29uc3QgZ2V0VmlkZW9zID0gKCkgPT4ge1xuXHRcdFx0Y29uc3QgdmlkZW9zID0gZG9HZXRSZWNvbW1lbmRhdGlvbkJhc2VzKGxpbmtTZWxlY3Rvcik7XG5cblx0XHRcdGlmICh2aWRlb3MubGVuZ3RoID49IG1pbmltdW0pIHtcblx0XHRcdFx0cmVzb2x2ZSh2aWRlb3MpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdCsrYXR0ZW1wdHM7XG5cdFx0XHRsb2coJ2Vycm9yJywgJ2ZhaWxlZCB0byBzY3JhcGUgdmlkZW9zIGZyb20gcGFnZSwgYXR0ZW1wdCcsIGF0dGVtcHRzLCAnb2YnLCBtYXhBdHRlbXB0cyk7XG5cblx0XHRcdGlmIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XG5cdFx0XHRcdGNvbnN0IGRlbGF5ID0gZGVsYXlzW2F0dGVtcHRzXTtcblx0XHRcdFx0bG9nKCd0cnlpbmcgYWdhaW4gaW4nLCBkZWxheSwgJ21zJyk7XG5cdFx0XHRcdHNldFRpbWVvdXQoZ2V0VmlkZW9zLCBkZWxheSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZWplY3QobmV3IEVycm9yKCdmYWlsZWQgdG8gZ2V0IGhvbWUgdmlkZW9zJykpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRnZXRWaWRlb3MoKTtcblx0fSk7XG59O1xuIiwiaW1wb3J0IHtsb2d9IGZyb20gJy4vbGliJztcblxuY29uc3QgZ2V0QWxsVGFicyA9IGFzeW5jICgpOiBQcm9taXNlPGNocm9tZS50YWJzLlRhYltdPiA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdGNocm9tZS50YWJzLnF1ZXJ5KHt9LCB0YWJzID0+IHtcblx0XHRpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7XG5cdFx0XHRyZWplY3QoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRyZXNvbHZlKHRhYnMpO1xuXHR9KTtcbn0pO1xuXG5jb25zdCBnZXRBY3RpdmVUYWIgPSBhc3luYyAoKTogUHJvbWlzZTxjaHJvbWUudGFicy5UYWIgfCB1bmRlZmluZWQ+ID0+XG5cdG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRjb25zdCBxdWVyeU9wdGlvbnMgPSB7YWN0aXZlOiB0cnVlLCBsYXN0Rm9jdXNlZFdpbmRvdzogdHJ1ZX07XG5cdFx0Y2hyb21lLnRhYnMucXVlcnkocXVlcnlPcHRpb25zLCAoW3RhYl0pID0+IHtcblx0XHRcdGlmIChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpIHtcblx0XHRcdFx0cmVqZWN0KGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0cmVzb2x2ZSh0YWIpO1xuXHRcdH0pO1xuXHR9KTtcblxuY2hyb21lLnRhYnMub25BY3RpdmF0ZWQuYWRkTGlzdGVuZXIodGFiID0+IHtcblx0Y29uc29sZS5sb2coJ05ldyB0YWI6JywgdGFiKTtcblx0Y29uc3Qge3RhYklkfSA9IHRhYjtcblxuXHRpZiAodGFiSWQgPT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYklkLCB7XG5cdFx0dHlwZTogJ3lvdXItdGFiLWlzLWFjdGl2ZScsXG5cdFx0dGFiSWQ6IHRhYi50YWJJZCxcblx0fSwgcmVzcG9uc2UgPT4ge1xuXHRcdGNvbnNvbGUubG9nKGBUYWIgJHt0YWJJZH0gcmVwbGllZDpgLCByZXNwb25zZSk7XG5cdH0pO1xuXG5cdGZvciAoY29uc3QgaWQgb2YgdGFiSWRzKSB7XG5cdFx0aWYgKGlkICE9PSB0YWJJZCkge1xuXHRcdFx0Y2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoaWQsIHtcblx0XHRcdFx0dHlwZTogJ3lvdXItdGFiLWlzLW5vdC1hY3RpdmUnLFxuXHRcdFx0XHR0YWJJZDogdGFiLnRhYklkLFxuXHRcdFx0fSwgcmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhgVGFiICR7aWR9IHJlcGxpZWQ6YCwgcmVzcG9uc2UpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG59KTtcblxuY29uc3QgdGFiSWRzID0gbmV3IFNldDxudW1iZXI+KCk7XG5cbmNocm9tZS50YWJzLm9uUmVtb3ZlZC5hZGRMaXN0ZW5lcih0YWJJZCA9PiB7XG5cdGNvbnNvbGUubG9nKCdUYWIgcmVtb3ZlZDonLCB0YWJJZCk7XG5cdHRhYklkcy5kZWxldGUodGFiSWQpO1xufSk7XG5cbmNvbnN0IG1haW4gPSBhc3luYyAoKSA9PiB7XG5cdGNvbnN0IFtpbml0aWFsVGFicywgYWN0aXZlVGFiXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRnZXRBbGxUYWJzKCksXG5cdFx0Z2V0QWN0aXZlVGFiKCksXG5cdF0pO1xuXG5cdGNvbnNvbGUubG9nKCdJbml0aWFsIHRhYnM6JywgaW5pdGlhbFRhYnMpO1xuXHRmb3IgKGNvbnN0IHtpZH0gb2YgaW5pdGlhbFRhYnMpIHtcblx0XHRpZiAoaWQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXG5cdFx0dGFiSWRzLmFkZChpZCk7XG5cblx0XHRpZiAoaWQgPT09IGFjdGl2ZVRhYj8uaWQpIHtcblx0XHRcdGxvZygnYWN0aXZlIHRhYjonLCBhY3RpdmVUYWIpO1xuXG5cdFx0XHRjaHJvbWUudGFicy5zZW5kTWVzc2FnZShpZCwge1xuXHRcdFx0XHR0eXBlOiAneW91ci10YWItaXMtYWN0aXZlJyxcblx0XHRcdFx0dGFiSWQ6IGlkLFxuXHRcdFx0fSwgcmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhgdGFiICR7aWR9IHJlcGxpZWQ6YCwgcmVzcG9uc2UpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKGlkLCB7XG5cdFx0XHRcdHR5cGU6ICd5b3VyLXRhYi1pcy1ub3QtYWN0aXZlJyxcblx0XHRcdFx0dGFiSWQ6IGlkLFxuXHRcdFx0fSwgcmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhgdGFiICR7aWR9IHJlcGxpZWQ6YCwgcmVzcG9uc2UpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG59O1xuXG5tYWluKCkuY2F0Y2goZXJyID0+IHtcblx0bG9nKCdlcnJvcicsICdmYWlsZWQgdG8gc3RhcnQgYmFja2dyb3VuZCBzY3JpcHQ6JywgZXJyKTtcbn0pO1xuIl0sIm5hbWVzIjpbImlzRGVidWciLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwibG9nIiwiYXJncyIsImNvbnNvbGUiLCJlcnJvciIsInNsaWNlIiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiaW5jbHVkZXMiLCJjcmVhdGVJbWFnZUV4aXN0cyIsImNocm9tZSIsInRhYnMiLCJvbkFjdGl2YXRlZCIsImFkZExpc3RlbmVyIiwidGFiIiwidGFiSWQiLCJ1bmRlZmluZWQiLCJzZW5kTWVzc2FnZSIsInR5cGUiLCJyZXNwb25zZSIsImlkIiwidGFiSWRzIiwiU2V0Iiwib25SZW1vdmVkIiwiUHJvbWlzZSIsImFsbCIsInJlc29sdmUiLCJyZWplY3QiLCJxdWVyeSIsInJ1bnRpbWUiLCJsYXN0RXJyb3IiLCJhY3RpdmUiLCJsYXN0Rm9jdXNlZFdpbmRvdyIsImluaXRpYWxUYWJzIiwiYWN0aXZlVGFiIiwiYWRkIiwiZXJyIl0sInNvdXJjZVJvb3QiOiIifQ==